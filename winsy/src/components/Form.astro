
<section class="bg-[#0e0e0e] text-white p-4 md:p-8 rounded-2xl max-w-md w-full">
  <p class="text-xl font-semibold mb-6">Envíanos un mensaje</p>

  <form method="POST" class="grid grid-cols-2 gap-4" id="myForm">

    <!-- Nombre -->
    <div class="flex flex-col col-span-2">
      <label for="name" class="text-sm font-medium mb-1">Tu Nombre *</label>
      <input
        type="text"
        id="name"
        name="name"
        required
        placeholder="Ingresa tu nombre"
        class="bg-transparent border border-gray-600 rounded-[10px] px-3 text-sm h-8 focus:border-cyan-400 transition-colors focus:ring-1 focus:ring-cyan-600 focus:outline-none"
      />
    </div>

    <!-- DNI -->
    <div class="flex flex-col col-span-2 md:col-span-1">
      <label for="dni" class="text-sm font-medium mb-1">DNI *</label>
      <input
        type="text"
        id="dni"
        name="dni"
        required
        placeholder="Ingresa tu DNI"
        class="bg-transparent border border-gray-600 rounded-[10px] px-3 text-sm h-8 focus:border-cyan-400 transition-colors focus:ring-1 focus:ring-cyan-600 focus:outline-none"
      />
    </div>


    <!-- Dirección del evento -->
    <div class="flex flex-col col-span-2 md:col-span-1">
      <label for="direccion_evento" class="text-sm font-medium mb-1">Dirección del evento *</label>
      <input
        type="text"
        id="direccion_evento"
        name="direccion_evento"
        required
        placeholder="Lugar del evento"
        class="bg-transparent border border-gray-600 rounded-[10px] px-3 text-sm h-8 focus:border-cyan-400 transition-colors focus:ring-1 focus:ring-cyan-600 focus:outline-none"
      />
    </div>

    <!-- Día -->
    <div class="flex flex-col col-span-2 md:col-span-1">
      <label for="dia" class="text-sm font-medium mb-1">Día *</label>
      <input
        type="date"
        id="dia"
        name="dia"
        required
        class="bg-transparent border border-gray-600 rounded-[10px] px-3 text-sm h-8 text-white focus:border-cyan-400 transition-colors focus:ring-1 focus:ring-cyan-600 focus:outline-none"
      />
    </div>

    <!-- Horario -->
    <div class="flex flex-col col-span-2 md:col-span-1">
      <label for="horario" class="text-sm font-medium mb-1">Horario *</label>
      <input
        type="time"
        id="horario"
        name="horario"
        required
        class="bg-transparent border border-gray-600 rounded-[10px] px-3 text-sm h-8 text-white focus:border-cyan-400 transition-colors focus:ring-1 focus:ring-cyan-600 focus:outline-none"
      />
    </div>

    <!-- Formato -->
    <div class="flex flex-col col-span-2 md:col-span-1">
      <label for="formato" class="text-sm font-medium mb-1">Formato *</label>
      <input
        type="text"
        id="formato"
        name="formato"
        required
        placeholder="Ejemplo: DJ, Banda, Acústico..."
        class="bg-transparent border border-gray-600 rounded-[10px] px-3 text-sm h-8 focus:border-cyan-400 transition-colors focus:ring-1 focus:ring-cyan-600 focus:outline-none"
      />
    </div>

    <!-- Cantidad de horas -->
    <div class="flex flex-col col-span-2 md:col-span-1">
      <label for="horas" class="text-sm font-medium mb-1">Cantidad de horas *</label>
      <input
        type="number"
        id="horas"
        name="horas"
        required
        placeholder="Ejemplo: 3"
        class="bg-transparent border border-gray-600 rounded-[10px] px-3 text-sm h-8 focus:border-cyan-400 transition-colors focus:ring-1 focus:ring-cyan-600 focus:outline-none"
      />
    </div>

    <!-- Email -->
    <div class="flex flex-col col-span-2">
      <label for="email" class="text-sm font-medium mb-1">Email *</label>
      <input
        type="email"
        id="email"
        name="email"
        required
        placeholder="tu@email.com"
        class="bg-transparent border border-gray-600 rounded-[10px] px-3 text-sm h-8 focus:border-cyan-400 transition-colors focus:ring-1 focus:ring-cyan-600 focus:outline-none"
      />
    </div>

    <!-- Teléfono con SVG ORIGINAL -->
    <div class="flex flex-col col-span-2">
      <label for="phone" class="text-sm font-medium mb-1">N° Teléfono *</label>
      <div class="relative">
        <span class="absolute left-2 top-1 text-gray-400">
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
            <path fill="currentColor"
              d="M19.5 22a1.5 1.5 0 0 0 1.5-1.5V17a1.5 1.5 0 0 0-1.5-1.5c-1.17 0-2.32-.18-3.42-.55a1.51 1.51 0 0 0-1.52.37l-1.44 1.44a14.77 14.77 0 0 1-5.89-5.89l1.43-1.43c.41-.39.56-.97.38-1.53c-.36-1.09-.54-2.24-.54-3.41A1.5 1.5 0 0 0 7 3H3.5A1.5 1.5 0 0 0 2 4.5C2 14.15 9.85 22 19.5 22M3.5 4H7a.5.5 0 0 1 .5.5c0 1.28.2 2.53.59 3.72c.05.14.04.34-.12.5L6 10.68c1.65 3.23 4.07 5.65 7.31 7.32l1.95-1.97c.14-.14.33-.18.51-.13c1.2.4 2.45.6 3.73.6a.5.5 0 0 1 .5.5v3.5a.5.5 0 0 1-.5.5C10.4 21 3 13.6 3 4.5a.5.5 0 0 1 .5-.5" />
          </svg>
        </span>

        <input
          type="tel"
          id="phone"
          name="phone"
          required
          placeholder="999 999 999"
          class="bg-transparent border border-gray-600 rounded-[10px] pl-9 pr-3 text-sm h-8 w-full focus:ring-1 focus:ring-cyan-600 focus:border-cyan-400 transition-colors focus:outline-none"
        />
      </div>
    </div>

    <!-- Notas -->
    <div class="flex flex-col col-span-2">
      <label for="notes" class="text-sm font-medium mb-1">Notas Adicionales</label>
      <textarea
        id="notes"
        name="notes"
        rows="3"
        placeholder="Especifica tu evento, lugar y más detalles"
        class="bg-transparent border border-gray-600 rounded-md px-3 py-2 text-sm resize-none focus:ring-1 focus:ring-cyan-600 focus:border-cyan-400 transition-colors focus:outline-none"
      ></textarea>
    </div>

    <!-- Botón -->
    <button
      type="submit"
      id="submitBtn"
      class="col-span-2 flex items-center justify-center relative cursor-pointer overflow-hidden h-9 px-3 py-2 gap-2 rounded-xl bg-cyan-600 hover:bg-cyan-500 transition-all text-white text-sm font-normal shadow-[inset_0_2px_0_0_rgba(255,255,255,0.1)] w-full disabled:opacity-50 disabled:cursor-not-allowed"
    >
      <span id="btnText">Enviar</span>
    </button>

    <p class="text-center col-span-2 py-1 font-semibold text-sm rounded-lg hidden" id="res"></p>

  </form>
</section>

<script>
// ===============================
// TIPADO DE ELEMENTOS
// ===============================
const form = document.getElementById("myForm") as HTMLFormElement;
const submitBtn = document.getElementById("submitBtn") as HTMLButtonElement;
const btnText = document.getElementById("btnText") as HTMLSpanElement;
const res = document.getElementById("res") as HTMLElement;

// Loader SVG
const loader = `
<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
  <circle cx="12" cy="2" r="0" fill="currentColor">
    <animate attributeName="r" begin="0" dur="1s" repeatCount="indefinite"
      values="0;2;0;0" />
  </circle>
</svg>
<span>Enviando</span>
`;

form?.addEventListener("submit", async (e: SubmitEvent) => {
  e.preventDefault();

  submitBtn.disabled = true;
  btnText.innerText = "Enviando Mensaje";

  const target = e.target as HTMLFormElement;

  // ===============================
  // PAYLOAD COMPLETO
  // ===============================
  const payload = {
    smtp_host: "smtp.hostinger.com",
    smtp_port: 465,
    smtp_user: "hola@efrael.com",
    smtp_pass: "~#2JI>bhu+0T",
    smtp_secure: "ssl",
    to: "winsymusic2025@gmail.com",
    from_name: "Nuevo formulario Winsy Music",
    title: "Mensaje desde la página web",
    subject: "Nuevo mensaje desde Winsy Music",

fields: {
  Nombre: target.name.value,
  DNI: target.dni.value,
  "Dirección del evento": target.direccion_evento.value,
  Día: target.dia.value,
  Horario: target.horario.value,
  Formato: target.formato.value,
  "Cantidad de horas": target.horas.value,
  Email: target.email.value,
  Teléfono: target.phone.value,
  Mensaje: target.notes.value,
  Fecha: new Date().toLocaleString("es-PE", { timeZone: "America/Lima" }),
},

  };

  try {
    const response = await fetch("https://mail.efrael.com/send-mail.php", {
      method: "POST",
      headers: { "Content-Type": "application/json; charset=UTF-8" },
      body: JSON.stringify(payload),
    });

    const data = await response.json();

    if (data.success) {
      res.innerText = data.message;
      res.classList.remove("hidden");
      res.classList.add("bg-green-500", "block");

      target.reset();
    } else {
      res.innerText = "Error al enviar mensaje.";
      res.classList.remove("hidden");
      res.classList.add("bg-red-500", "block");
    }
  } catch (err) {
    res.innerText = "Error al enviar mensaje, intente de nuevo";
    res.classList.remove("hidden");
    res.classList.add("bg-red-500", "block");
  } finally {
    submitBtn.disabled = false;
    btnText.textContent = "Enviar";
  }
});

</script>
